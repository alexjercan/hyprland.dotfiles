#!/usr/bin/env bash

COLOR_RED='\033[0;31m'
COLOR_YELLOW='\033[0;33m'
COLOR_GREEN='\033[0;32m'
COLOR_BLUE='\033[0;34m'
COLOR_RESET='\033[0m'

if [[ ! -x "$(command -v Hyprland)" ]]; then
    echo -e "${COLOR_RED}Hyprland is not installed.${COLOR_RESET} Please install Hyprland first."
    exit 1
fi

SCRIPT_DIR=$(dirname $(readlink -f $0))

# DEPENDENCIES #
# This script will install the dependencies for the dotfiles we assume that
# you already have hyprland installed

echo -e "${COLOR_BLUE}Installing dependencies...${COLOR_RESET}"

DISTRO=$(cat /etc/os-release | grep -oP '(?<=^ID=).+' | tr -d '"')
if [[ $DISTRO == "arch" ]]; then
    echo -e "${COLOR_BLUE}Installing dependencies for Arch Linux...${COLOR_RESET}"
    $SCRIPT_DIR/distro/arch
else
    echo -e "${COLOR_RED}Unsupported distro: $DISTRO${COLOR_RESET}"
    echo -e "${COLOR_YELLOW}You can raise an issue at https://github.com/alexjercan/hyprland.dotfiles/issues to add support for your distro${COLOR_RESET}"
    exit 1
fi

# HYPRLAND CONFIG #

HYPR_DIR=$SCRIPT_DIR/hypr
AUTONAME_DIR=$SCRIPT_DIR/hyprland-autoname-workspaces

echo -e "${COLOR_BLUE}Setting up config files...${COLOR_RESET}"

### Set the config files ###
read -n1 -rep 'Would you like to copy config files? This will overwrite any existing config files. (y,n)' CFG
if [[ $CFG == "Y" || $CFG == "y" ]]; then
    # Remove the old config
    unlink ~/.config/hypr 2> /dev/null || rm -rf ~/.config/hypr

    # Set the config to the default
    cp $HYPR_DIR/hyprland.default.conf $HYPR_DIR/hyprland.conf
    ln -s $HYPR_DIR ~/.config/hypr

    # Set the autoname config
    unlink ~/.config/hyprland-autoname-workspaces 2> /dev/null || rm -rf ~/.config/hyprland-autoname-workspaces
    ln -s $AUTONAME_DIR ~/.config/hyprland-autoname-workspaces
fi

### Set the theme ###

echo -e "${COLOR_BLUE}Setting up theme...${COLOR_RESET}"

read -n1 -rep 'Would you like to install hyprtheme? (y,n)' INSTHT
if [[ $INSTHT == "Y" || $INSTHT == "y" ]]; then
    mkdir -p ~/.cache/hyprtheme
    git clone https://github.com/hyprland-community/hyprtheme ~/.cache/hyprtheme
    cd ~/.cache/hyprtheme
    make all
    cd -

    # Set the theme to nothing; just create the directory
    mkdir -p ~/.config/hypr/themes/dist
    touch ~/.config/hypr/themes/dist/dist.conf
fi

if [[ -x "$(command -v hyprtheme)" ]];
then
    read -n1 -rep 'What theme would you like to set: default (0), breaking-bad (1), darker (2), gruvbox (3)?' THEME
    if [[ $THEME == "1" ]]; then
        git clone https://github.com/alexjercan/breakingbad-hyprland-theme.git ~/.config/hypr/themes/breakingbad-hyprland-theme
        bash ~/.config/hypr/themes/breakingbad-hyprland-theme/install
        hyprtheme apply breakingbad-hyprland-theme
    elif [[ $THEME == "2" ]]; then
        git clone https://github.com/alexjercan/darker-hyprland-theme.git ~/.config/hypr/themes/darker-hyprland-theme
        bash ~/.config/hypr/themes/darker-hyprland-theme/install
        hyprtheme apply darker-hyprland-theme
    elif [[ $THEME == "3" ]]; then
        git clone https://github.com/alexjercan/gruv-hyprland-theme.git ~/.config/hypr/themes/gruv-hyprland-theme
        bash ~/.config/hypr/themes/gruv-hyprland-theme/install
        hyprtheme apply gruv-hyprland-theme
    fi
fi

# INSTALLATION COMPLETE #

echo -e "${COLOR_GREEN}Installation complete!${COLOR_RESET}"
echo "You can now login into your hyprland session."
